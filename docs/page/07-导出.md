# 导出页面

## 页面标识
- **页面名称**: Export / 导出
- **触发方式**: 模态弹窗
- **调用位置**: 故事板编辑器"导出"按钮
- **页面类型**: 功能性弹窗

---

## 页面目标
1. 提供多种导出格式选择
2. 配置导出参数
3. 生成可交付成果
4. 支持不同使用场景

---

## 布局结构

### 弹窗布局
```
┌─────────────────────────────────────────────┐
│  导出项目                                 [×] │
├─────────────────────────────────────────────┤
│                                             │
│  选择导出格式:                               │
│                                             │
│  ┌───────┐  ┌───────┐  ┌───────┐  ┌───────┐│
│  │ 🎬   │  │ 📄   │  │ 🖼️  │  │ 📜   ││
│  │ 视频  │  │ PDF  │  │图片序列│  │ 文本  ││
│  └───────┘  └───────┘  └───────┘  └───────┘│
│                                             │
│  导出设置:                                   │
│  ┌─────────────────────────────────────┐   │
│  │ [设置选项根据选择的格式动态变化]      │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  [取消] [开始导出]                           │
└─────────────────────────────────────────────┘
```

---

## 组件详细设计

### 1. 导出格式选择

#### 格式卡片布局
```
┌─────────┐
│  图标   │
│  格式名  │
│  说明   │
└─────────┘
```

#### 卡片样式
```css
宽度: 140px
高度: 160px
背景: #FFFFFF
边框: 2px solid #E4E7EC
圆角: 12px
内边距: 20px
对齐: 居中

默认状态:
  边框: #E4E7EC
  
悬停状态:
  边框: #3B82F6
  背景: #F0F5FF
  
选中状态:
  边框: 3px solid #3B82F6
  背景: #F0F5FF
  阴影: 0 4px 12px rgba(59,130,246,0.2)
```

---

### 2. 导出格式详细设计

#### 格式1: 视频导出

**卡片内容**:
```
图标: 🎬 (64px)
标题: "视频"
说明: "MP4高清视频"
推荐: [推荐] 标签
```

**导出设置面板**:
```
┌─────────────────────────────────────────┐
│ 视频设置                                 │
├─────────────────────────────────────────┤
│                                         │
│ 分辨率:                                  │
│ ○ 1080p (1920×1080) - 推荐              │
│ ○ 720p (1280×720)                      │
│ ○ 480p (854×480)                       │
│                                         │
│ 帧率:                                    │
│ [30 FPS ▼]                              │
│                                         │
│ 编码格式:                                │
│ [H.264 ▼]                               │
│                                         │
│ 视频质量:                                │
│ ○ 高质量 (文件较大)                      │
│ ○ 标准质量 (推荐)                        │
│ ○ 压缩质量 (文件较小)                    │
│                                         │
│ 添加水印:                                │
│ ☐ 在视频右下角添加OneStory水印           │
│                                         │
│ 预计文件大小: 约 8.5MB                   │
│ 预计生成时间: 约 2分钟                    │
│                                         │
└─────────────────────────────────────────┘
```

**配置选项**:
- 分辨率: 1080p / 720p / 480p
- 帧率: 24 / 30 / 60 FPS
- 编码: H.264 / H.265
- 质量: 高 / 中 / 低
- 水印: 是 / 否

#### 格式2: PDF导出

**卡片内容**:
```
图标: 📄 (64px)
标题: "PDF"
说明: "故事板文档"
```

**导出设置面板**:
```
┌─────────────────────────────────────────┐
│ PDF设置                                  │
├─────────────────────────────────────────┤
│                                         │
│ 页面布局:                                │
│ ○ 每页1个镜头 (详细版)                   │
│ ○ 每页2个镜头                           │
│ ○ 每页4个镜头 (紧凑版)                   │
│                                         │
│ 页面方向:                                │
│ ○ 横向 (推荐)                           │
│ ○ 纵向                                  │
│                                         │
│ 包含内容:                                │
│ ☑ 镜头预览图                            │
│ ☑ 场景描述                              │
│ ☑ 时长信息                              │
│ ☑ 角色信息                              │
│ ☑ 项目封面页                            │
│ ☑ 序号和页码                            │
│                                         │
│ 纸张大小:                                │
│ [A4 ▼]                                  │
│                                         │
└─────────────────────────────────────────┘
```

#### 格式3: 图片序列导出

**卡片内容**:
```
图标: 🖼️ (64px)
标题: "图片序列"
说明: "分镜图片合集"
```

**导出设置面板**:
```
┌─────────────────────────────────────────┐
│ 图片序列设置                             │
├─────────────────────────────────────────┤
│                                         │
│ 图片格式:                                │
│ ○ PNG (无损，推荐)                       │
│ ○ JPG (体积小)                          │
│ ○ WebP (兼顾质量和体积)                  │
│                                         │
│ 图片尺寸:                                │
│ ○ 原始尺寸                              │
│ ○ 1920×1080                            │
│ ○ 1280×720                             │
│ ○ 自定义: [宽度] × [高度]               │
│                                         │
│ 文件命名:                                │
│ ○ shot_001.png, shot_002.png...        │
│ ○ 项目名_001.png, 项目名_002.png...     │
│                                         │
│ 打包方式:                                │
│ ○ ZIP压缩包 (推荐)                       │
│ ○ 单独下载                              │
│                                         │
│ 包含信息卡:                              │
│ ☑ 为每个镜头生成信息卡片                 │
│   (包含场景描述、时长等)                  │
│                                         │
└─────────────────────────────────────────┘
```

#### 格式4: 文本脚本导出

**卡片内容**:
```
图标: 📜 (64px)
标题: "文本脚本"
说明: "纯文本格式"
```

**导出设置面板**:
```
┌─────────────────────────────────────────┐
│ 文本脚本设置                             │
├─────────────────────────────────────────┤
│                                         │
│ 文件格式:                                │
│ ○ TXT (纯文本)                          │
│ ○ Markdown                             │
│ ○ Word文档 (.docx)                      │
│ ○ Final Draft格式                       │
│                                         │
│ 包含内容:                                │
│ ☑ 镜头序号                              │
│ ☑ 场景描述                              │
│ ☑ 角色信息                              │
│ ☑ 时长标注                              │
│ ☑ 镜头类型                              │
│ ☐ 技术备注                              │
│                                         │
│ 格式化选项:                              │
│ ☑ 自动添加序号                          │
│ ☑ 场景描述缩进                          │
│ ☑ 镜头之间添加分隔线                     │
│                                         │
└─────────────────────────────────────────┘
```

---

### 3. 导出进度界面

#### 进度弹窗
```
┌─────────────────────────────────────────┐
│  正在导出...                             │
├─────────────────────────────────────────┤
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ ⟳ 正在生成视频...               │   │
│  │                                 │   │
│  │ ━━━━━━━━━━━━━━━━ 65%            │   │
│  │                                 │   │
│  │ 已处理: 8/12 个镜头              │   │
│  │ 预计剩余时间: 45秒               │   │
│  └─────────────────────────────────┘   │
│                                         │
│            [取消导出]                    │
│                                         │
└─────────────────────────────────────────┘
```

#### 进度阶段

**视频导出进度**:
```
1. 准备素材 (10%)
2. 合成视频 (60%)
3. 编码压缩 (20%)
4. 上传/保存 (10%)
```

**PDF导出进度**:
```
1. 渲染页面 (40%)
2. 生成PDF (40%)
3. 优化文件 (20%)
```

**图片序列进度**:
```
1. 导出图片 (70%)
2. 生成信息卡 (10%)
3. 压缩打包 (20%)
```

---

### 4. 导出完成界面

#### 成功状态
```
┌─────────────────────────────────────────┐
│  导出成功! ✓                             │
├─────────────────────────────────────────┤
│                                         │
│          ✓                              │
│     导出完成                             │
│                                         │
│  文件名: 新建项目2025-10-24.mp4          │
│  文件大小: 8.5MB                         │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ [📁 打开文件位置]                │   │
│  │ [⬇ 下载到本地]                   │   │
│  │ [🔗 复制分享链接]                │   │
│  └─────────────────────────────────┘   │
│                                         │
│            [完成]                        │
│                                         │
└─────────────────────────────────────────┘
```

#### 失败状态
```
┌─────────────────────────────────────────┐
│  导出失败 ⚠️                            │
├─────────────────────────────────────────┤
│                                         │
│          ⚠️                             │
│     导出过程中出现错误                   │
│                                         │
│  错误原因:                               │
│  部分图片生成失败，无法合成完整视频       │
│                                         │
│  建议:                                   │
│  - 检查未生成的镜头                      │
│  - 重新生成图片后再次导出                │
│                                         │
│  [查看详情] [重试] [关闭]                │
│                                         │
└─────────────────────────────────────────┘
```

---

## 导出流程

### 视频导出流程
```
1. 用户选择"视频"格式
2. 配置导出参数（分辨率、质量等）
3. 点击"开始导出"
4. 后端处理:
   a. 获取所有镜头图片
   b. 按时长和顺序合成视频
   c. 应用过渡效果
   d. 添加音频（如有）
   e. 编码压缩
5. 生成下载链接
6. 用户下载文件
```

### PDF导出流程
```
1. 选择PDF格式和布局
2. 后端渲染:
   a. 生成封面页
   b. 逐个渲染镜头页
   c. 添加页码和标注
   d. 生成PDF文件
3. 提供下载
```

### 实时导出 vs 后台导出

**实时导出**（文件<50MB）:
```
- 用户等待导出完成
- 显示实时进度
- 完成后立即下载
- 适用: PDF、图片序列、文本
```

**后台导出**（文件>50MB或复杂视频）:
```
1. 提交导出任务
2. 后台队列处理
3. 发送通知:
   - 浏览器通知
   - 邮件通知（可选）
4. 在消息中心查看状态
5. 完成后下载
```

---

## API端点

### 提交导出任务
```
端点: POST /api/storyboard/export
请求体:
{
  "projectId": "f6d162c...",
  "format": "video" | "pdf" | "images" | "text",
  "settings": {
    "resolution": "1080p",
    "quality": "standard",
    "watermark": false,
    ...
  }
}

响应:
{
  "code": 200,
  "data": {
    "taskId": "export_123456",
    "estimatedTime": 120,
    "status": "processing"
  }
}
```

### 查询导出状态
```
端点: GET /api/storyboard/export/status/{taskId}

响应:
{
  "code": 200,
  "data": {
    "status": "completed" | "processing" | "failed",
    "progress": 100,
    "downloadUrl": "...",
    "fileSize": 8912345,
    "error": null
  }
}
```

---

## 数据埋点

```javascript
// 打开导出弹窗
Amplitude.track('export_dialog_opened', {
  project_id: 'f6d162c...',
  shot_count: 12
})

// 选择导出格式
Amplitude.track('export_format_selected', {
  format: 'video',
  resolution: '1080p'
})

// 开始导出
Amplitude.track('export_started', {
  project_id: 'f6d162c...',
  format: 'video',
  settings: {...}
})

// 导出完成
Amplitude.track('export_completed', {
  project_id: 'f6d162c...',
  format: 'video',
  file_size: 8912345,
  duration_seconds: 125
})

// 导出失败
Amplitude.track('export_failed', {
  project_id: 'f6d162c...',
  format: 'video',
  error: 'image_generation_failed'
})
```

---

## 错误处理

### 常见错误

**镜头图片未生成**:
```
提示: "部分镜头的图片尚未生成，无法导出视频"
操作: 
  - 显示未生成的镜头列表
  - 提供"生成图片"快捷按钮
  - 支持跳过未生成的镜头导出
```

**文件过大**:
```
提示: "导出文件将超过100MB，建议降低分辨率或质量"
操作:
  - 显示预计文件大小
  - 建议优化参数
  - 支持分段导出
```

**网络错误**:
```
提示: "网络连接中断，导出失败"
操作:
  - 保存导出进度
  - 支持断点续传
  - 重试机制
```

---

## 预设导出模板

### 快速导出选项
```
┌─────────────────────────────────────────┐
│ 快速导出:                                │
│                                         │
│ [社交媒体视频]                           │
│   1080×1080, 30fps, 适合抖音/小红书      │
│                                         │
│ [YouTube视频]                           │
│   1920×1080, 60fps, 高质量               │
│                                         │
│ [演示PDF]                                │
│   A4横向, 每页2个镜头, 含详细信息         │
│                                         │
│ [客户预览PDF]                            │
│   A4纵向, 每页1个镜头, 精美排版           │
│                                         │
└─────────────────────────────────────────┘
```

---

## 性能优化

### 导出队列
```
优先级:
  1. 快速导出（PDF、文本）
  2. 小视频（<30秒）
  3. 大视频（>30秒）
  
并发控制:
  - 同时处理最多3个导出任务
  - 超出进入等待队列
```

### 缓存策略
```
缓存导出结果:
  - 相同参数的导出缓存24小时
  - 项目更新后自动失效
  - 节省服务器资源
```

---

## 相关页面
- [故事板编辑器](./03-故事板编辑器.md)
- [视频预览](./06-视频预览.md)
