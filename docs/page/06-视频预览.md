# 视频预览页面

## 页面标识
- **页面名称**: Video Preview / 视频预览播放器
- **触发方式**: 弹窗/模态框
- **调用位置**: 
  - 故事板编辑器"预览"按钮
  - 项目卡片悬停预览
  - Dashboard项目列表
- **组件名称**: FilePlayer
- **页面类型**: 模态弹窗

---

## 页面目标
1. 预览生成的视频效果
2. 提供完整的播放控制
3. 支持全屏播放
4. 视频质量评估

---

## 布局结构

### 弹窗整体布局
```
┌─────────────────────────────────────────────┐
│  视频预览                                 [×] │
├─────────────────────────────────────────────┤
│                                             │
│  ┌───────────────────────────────────────┐  │
│  │                                       │  │
│  │                                       │  │
│  │         视频播放区域                   │  │
│  │         (16:9比例)                     │  │
│  │                                       │  │
│  │                                       │  │
│  └───────────────────────────────────────┘  │
│  ┌───────────────────────────────────────┐  │
│  │ [▶] ━━━━━━━●━━━━━━━ 00:05 / 00:36    │  │
│  │                        [🔊] [⛶]       │  │
│  └───────────────────────────────────────┘  │
│                                             │
│  [下载视频] [分享] [编辑项目]                 │
└─────────────────────────────────────────────┘
```

---

## 组件详细设计

### 1. 弹窗容器

#### 尺寸规范
```css
宽度: 900px (桌面端)
最大高度: 90vh
背景: #000000 (深色主题)
圆角: 16px
阴影: 0 8px 32px rgba(0,0,0,0.4)
内边距: 0 (视频全屏显示)
z-index: 10000
```

#### 遮罩层
```css
背景: rgba(0,0,0,0.85)
模糊: backdrop-filter: blur(8px)
点击: 关闭弹窗（可选）
```

---

### 2. 弹窗头部

#### 布局
```
┌─────────────────────────────────────────────┐
│  视频预览                                 [×] │
└─────────────────────────────────────────────┘
```

#### 组件元素

**标题**:
```
文本: "视频预览" / 项目名称
字号: 18px
字重: Medium
颜色: #FFFFFF
位置: 左侧
```

**关闭按钮**:
```
图标: × 叉号
尺寸: 32px × 32px
颜色: #FFFFFF
悬停: 背景rgba(255,255,255,0.1)
圆角: 4px
快捷键: Esc
```

#### 样式
```css
高度: 56px
背景: rgba(0,0,0,0.9)
内边距: 0 20px
边框底部: 1px solid rgba(255,255,255,0.1)
```

---

### 3. 视频播放区域

#### 视频容器
```css
宽度: 100%
高度: 自适应（保持16:9）
最大高度: calc(90vh - 160px)
背景: #000000
```

#### video标签配置
```html
<video
  src="static.chuangyi-keji.com/converted_videos/..."
  controls={false}
  autoplay={false}
  loop={false}
  muted={false}
  preload="metadata"
>
```

#### 视频源
```
路径: static.chuangyi-keji.com/converted_videos/
格式: MP4 (H.264编码)
命名: {timestamp}_{randomId}_original.mp4
示例: 1761283524_xK2zQZ_original.mp4

加载策略:
  - 支持Range请求（分段加载）
  - 请求头: Range: bytes=0-
  - 后续请求: bytes=32768-, bytes=65536-
```

#### 加载状态

**加载中**:
```
显示: 旋转加载图标
文字: "视频加载中..."
背景: 黑色
```

**缓冲中**:
```
显示: 进度环
覆盖层: 半透明黑色
```

**加载失败**:
```
┌─────────────────────────┐
│         ⚠️              │
│    视频加载失败          │
│  请检查网络连接或重试    │
│                         │
│    [重新加载]           │
└─────────────────────────┘
```

---

### 4. 播放器控制条

#### 控制条布局
```
┌───────────────────────────────────────────────────────────┐
│ [▶] ━━━━━━━━━━●━━━━━━━━━━ 00:05 / 00:36  [🔊] [⚙] [⛶]   │
└───────────────────────────────────────────────────────────┘
```

#### 样式规范
```css
高度: 56px
背景: rgba(0,0,0,0.85)
内边距: 0 16px
位置: 绝对定位（视频底部）
显示: 悬停时显示，3秒后自动隐藏
过渡: opacity 300ms
```

---

### 5. 播放控制组件

#### 播放/暂停按钮

**按钮样式**:
```
尺寸: 40px × 40px
圆角: 20px（圆形）
背景: rgba(255,255,255,0.1)
悬停: rgba(255,255,255,0.2)
```

**图标**（SVG Base64）:
```
播放图标(▶):
  颜色: #FFFFFF
  尺寸: 20px × 20px
  
暂停图标(❚❚):
  颜色: #FFFFFF
  尺寸: 20px × 20px
```

**交互**:
- 点击: 切换播放/暂停
- 快捷键: Space空格键

---

### 6. 进度条组件

#### 进度条结构
```
━━━━━━━━━●━━━━━━━━━━
└───────┬┘└─────────┘
   已播放  未播放
```

#### 样式设计

**轨道（Track）**:
```css
高度: 4px
背景: rgba(255,255,255,0.2)
圆角: 2px
宽度: flex-1
光标: pointer
```

**已播放进度（Progress）**:
```css
高度: 4px
背景: 主色 / #3B82F6
圆角: 2px
宽度: 按播放进度百分比
```

**缓冲进度**:
```css
背景: rgba(255,255,255,0.4)
显示: 已缓冲的视频段
```

**拖动手柄（Thumb）**:
```css
尺寸: 14px × 14px
背景: #FFFFFF
圆角: 50%（圆形）
阴影: 0 2px 4px rgba(0,0,0,0.3)
显示: 悬停/拖拽时
光标: grab / grabbing
```

#### 交互功能

**拖拽跳转**:
```
1. 鼠标按下进度条
2. 显示预览缩略图（可选）
3. 拖动到目标位置
4. 释放后跳转播放
```

**点击跳转**:
```
点击进度条任意位置
立即跳转到该时间点
```

**悬停提示**:
```
┌─────────────┐
│ 00:15       │ ← 时间显示
│ ┌─────────┐ │
│ │缩略图   │ │ ← 该时间点画面（可选）
│ └─────────┘ │
└─────────────┘
```

---

### 7. 时间显示

#### 格式
```
00:05 / 00:36
└──┬┘   └──┬┘
当前时间  总时长
```

#### 样式
```css
字号: 13px
字重: Medium
颜色: #FFFFFF
字体: 等宽字体（Monospace）
最小宽度: 120px
```

#### 时间格式化
```javascript
短视频(<1小时): MM:SS
  示例: 00:36
  
长视频(≥1小时): HH:MM:SS
  示例: 01:23:45
```

---

### 8. 音量控制

#### 音量按钮
```
图标: 🔊 音量图标
尺寸: 32px × 32px
状态:
  - 有声: 🔊
  - 静音: 🔇
点击: 切换静音/取消静音
```

#### 音量滑块（悬停展开）
```
┌────┐
│ 🔊 │ ← 音量按钮
└──┬─┘
   │ 
   ┃  ← 垂直滑块
   ┃  
   ●  ← 拖动手柄
   ┃
   ┃
```

滑块样式:
```css
方向: 垂直
高度: 100px
宽度: 4px
背景: rgba(255,255,255,0.2)
手柄: 12px圆形
显示: 悬停音量按钮时
```

音量范围: 0-100%

---

### 9. 设置菜单

#### 设置按钮
```
图标: ⚙ 齿轮
尺寸: 32px × 32px
点击: 打开设置菜单
```

#### 设置菜单内容
```
┌─────────────────┐
│ 播放速度         │
│  > 0.5x         │
│    0.75x        │
│    1.0x  ✓      │ ← 当前选中
│    1.25x        │
│    1.5x         │
│    2.0x         │
│                 │
│ 视频质量         │
│    自动  ✓      │
│    1080p        │
│    720p         │
│    480p         │
└─────────────────┘
```

菜单样式:
```css
宽度: 180px
背景: rgba(0,0,0,0.95)
圆角: 8px
阴影: 0 4px 12px rgba(0,0,0,0.3)
位置: 按钮上方弹出
```

---

### 10. 全屏按钮

#### 按钮设计
```
图标: ⛶ 全屏图标
尺寸: 32px × 32px
状态:
  - 未全屏: ⛶
  - 已全屏: ⛷ (退出全屏)
点击: 切换全屏
快捷键: F / 双击视频
```

#### 全屏模式

**进入全屏**:
```
1. 视频填充整个屏幕
2. 控制条保持在底部
3. 鼠标移动显示控制条
4. 3秒无操作自动隐藏控制条
```

**退出全屏**:
```
方式:
  - 点击退出全屏按钮
  - 按Esc键
  - 双击视频
```

---

### 11. 操作按钮区

#### 布局
```
┌─────────────────────────────────────────────┐
│  [下载视频] [分享到社交媒体] [返回编辑]       │
└─────────────────────────────────────────────┘
```

#### 按钮设计

**下载视频按钮**:
```
图标: ⬇ 下载
文本: "下载视频"
类型: 主要按钮
尺寸: 120px × 40px
功能: 下载视频文件到本地
```

**分享按钮**:
```
图标: 🔗 分享
文本: "分享"
类型: 次要按钮
尺寸: 100px × 40px
点击: 打开分享菜单
```

分享菜单:
```
┌─────────────────┐
│ 复制链接         │
│ TikTok          │
│ Bilibili        │
│ 微信            │
│ 微博            │
└─────────────────┘
```

**返回编辑按钮**:
```
文本: "返回编辑"
类型: 文本按钮
功能: 关闭预览，返回编辑器
```

#### 按钮容器样式
```css
高度: 80px
背景: rgba(0,0,0,0.9)
内边距: 20px
对齐: 居中
间距: 12px
```

---

## 交互流程

### 播放流程
```
1. 打开预览弹窗
2. 视频开始加载（显示loading）
3. 加载完成，显示首帧
4. 用户点击播放
5. 视频开始播放
6. 播放完成，显示重播按钮
```

### 下载流程
```
1. 点击"下载视频"按钮
2. 检查视频状态（是否生成完成）
3. 开始下载
4. 显示下载进度（可选）
5. 下载完成提示
```

### 分享流程
```
1. 点击"分享"按钮
2. 显示分享选项菜单
3. 选择分享渠道
4. 生成分享链接/唤起分享接口
5. 复制链接或跳转到社交平台
6. 显示分享成功提示
```

---

## 键盘快捷键

```
Space         : 播放/暂停
F / 双击      : 全屏/退出全屏
Esc           : 退出全屏/关闭弹窗
← / →        : 后退/前进 5秒
↑ / ↓        : 音量增加/减少
M             : 静音/取消静音
0-9           : 跳转到 0%-90% 位置
```

---

## 视频加载优化

### Range请求策略
```
首次请求:
  Range: bytes=0-
  作用: 获取视频元数据和首段数据
  
后续请求:
  Range: bytes=32768-
  Range: bytes=65536-
  作用: 按需加载后续数据
  
优势: 
  - 快速首屏加载
  - 节省带宽
  - 支持拖拽跳转
```

### 预加载策略
```
预加载范围: 当前播放位置 + 10秒
缓冲策略: 智能预测用户行为
清理策略: 播放过的片段保留，超过30秒的清理
```

---

## 错误处理

### 视频加载失败
```
显示: 错误提示界面
原因检测:
  - 网络错误
  - 视频文件不存在
  - 格式不支持
操作: [重试] [报告问题] [返回]
```

### 播放错误
```
错误类型:
  - 解码错误
  - 网络中断
  - 浏览器不支持
  
处理:
  1. 显示错误提示
  2. 提供降级方案（切换清晰度）
  3. 记录错误日志
```

---

## 数据埋点

```javascript
// 打开视频预览
Amplitude.track('video_preview_opened', {
  project_id: 'f6d162c...',
  video_duration: 36,
  source: 'editor' / 'dashboard'
})

// 播放视频
Amplitude.track('video_played', {
  project_id: 'f6d162c...',
  play_position: 0
})

// 下载视频
Amplitude.track('video_downloaded', {
  project_id: 'f6d162c...',
  video_size: '5.2MB'
})

// 分享视频
Amplitude.track('video_shared', {
  project_id: 'f6d162c...',
  platform: 'tiktok' / 'bilibili'
})
```

---

## 响应式设计

### 桌面端（>1024px）
- 弹窗宽度: 900px
- 完整功能

### 平板端（768-1024px）
- 弹窗宽度: 90vw
- 控制条简化

### 移动端（<768px）
- 全屏显示
- 原生播放器（可选）
- 简化控制条
- 手势控制:
  - 左右滑动: 快进/快退
  - 上下滑动: 音量调节

---

## 相关页面
- [故事板编辑器](./03-故事板编辑器.md)
- [导出页面](./07-导出.md)
